<header>
    <h1>포럼 서브포럼</h1>
    <% if (isLoggedIn) { %>
        <nav>
            <ul>
                <li>환영합니다, <%= user.username %>님!</li>
                <li><a href="/profile">프로필</a></li>
                <% if (user.role === 'super_admin') { %>
                    <li><a href="/admin">관리자</a></li>
                <% } %>
                <li><a href="/auth/logout">로그아웃</a></li>
            </ul>
        </nav>
    <% } else { %>
        <nav>
            <ul>
                <li><a href="/auth/login">로그인</a></li>
                <li><a href="/auth/register">회원가입</a></li>
            </ul>
        </nav>
    <% } %>
</header>

<!-- 검색 폼 -->
<section>
    <form method="GET" action="/search" x-data="{ query: '' }">
        <fieldset role="group">
            <input
                type="search"
                name="q"
                placeholder="게시글 검색..."
                x-model="query"
                value="<%= typeof query !== 'undefined' ? query : '' %>"
            >
            <button type="submit">검색</button>
        </fieldset>
    </form>
</section>

<!-- 서브포럼 목록 -->
<section>
    <% if (subforums && subforums.length > 0) { %>
        <div class="grid">
            <% subforums.forEach(subforum => { %>
                <article>
                    <header>
                        <h3><a href="/forum/subforum/<%= subforum.id %>"><%= subforum.name %></a></h3>
                    </header>
                    <p><%= subforum.description || '설명이 없습니다.' %></p>
                    <footer>
                        <small>
                            게시글: <%= subforum.post_count || 0 %>개 |
                            댓글: <%= subforum.comment_count || 0 %>개 |
                            최근 활동: <%= subforum.last_activity_at ? new Date(subforum.last_activity_at).toLocaleDateString('ko-KR') : '없음' %>
                        </small>
                    </footer>
                </article>
            <% }); %>
        </div>
    <% } else { %>
        <article>
            <header>
                <h3>서브포럼이 없습니다</h3>
            </header>
            <p>아직 생성된 서브포럼이 없습니다.</p>
            <% if (isLoggedIn && user.role === 'super_admin') { %>
                <footer>
                    <a href="/admin/forums/new" role="button">첫 번째 서브포럼 만들기</a>
                </footer>
            <% } %>
        </article>
    <% } %>
</section>

<!-- 인기 게시글 -->
<% if (popularPosts && popularPosts.length > 0) { %>
<section>
    <h2>인기 게시글</h2>
    <div class="grid">
        <% popularPosts.forEach(post => { %>
            <article>
                <header>
                    <h4>
                        <a href="/forum/subforum/<%= post.category_id %>/post/<%= post.id %>">
                            <%= post.title %>
                        </a>
                    </h4>
                </header>
                <footer>
                    <small>
                        <%= post.subforum_name || '' %> |
                        <%= post.username || '알 수 없음' %> |
                        조회 <%= post.view_count %> |
                        댓글 <%= post.comment_count %>
                    </small>
                </footer>
            </article>
        <% }); %>
    </div>
</section>
<% } %>

<!-- 최근 활동 게시글 -->
<% if (recentActivityPosts && recentActivityPosts.length > 0) { %>
<section>
    <h2>최근 활동</h2>
    <div class="grid">
        <% recentActivityPosts.forEach(post => { %>
            <article>
                <header>
                    <h4>
                        <a href="/forum/subforum/<%= post.category_id %>/post/<%= post.id %>">
                            <%= post.title %>
                        </a>
                    </h4>
                </header>
                <footer>
                    <small>
                        <%= post.subforum_name || '' %> |
                        <%= post.username || '알 수 없음' %> |
                        최근 댓글: <%= post.last_commenter || '없음' %> |
                        <%= new Date(post.last_comment_at).toLocaleDateString('ko-KR') %>
                    </small>
                </footer>
            </article>
        <% }); %>
    </div>
</section>
<% } %>